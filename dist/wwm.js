"use strict";class e{constructor(e,t){this.type=e,this.value=t}static validate(t){return e.supported.indexOf(t.type)>-1&&("image"===t.type&&(t.value=`url(${t.value})`),!0)}static supported=["image","color"]}class t{constructor(e){this.name=e}}class i{constructor(e){this.listeners=e||[],this.eventsCallbacks={}}emit(e){for(let t=0,i=this.listeners.length;t<i;++t)this.listeners[t].trigger(e)}on(e,t){this.eventsCallbacks[e]||(this.eventsCallbacks[e]={on:[],once:[]}),this.eventsCallbacks[e].on.push(t)}once(e,t){this.eventsCallbacks[e]||(this.eventsCallbacks[e]={on:[],once:[]}),this.eventsCallbacks[e].once.push(t)}trigger(e){this.eventsCallbacks[e.name]&&this.eventsCallbacks[e.name].once&&(this.eventsCallbacks[e.name].once.map(t=>t(e)),this.eventsCallbacks[e.name].once=[]),this.eventsCallbacks[e.name]&&this.eventsCallbacks[e.name].on&&this.eventsCallbacks[e.name].on.map(t=>t(e))}subscribe(e){this.listeners.indexOf(e)<=-1&&this.listeners.push(e)}}var s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),n=new Uint8Array(16);function r(){if(!s)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(n)}for(var a=[],o=0;o<256;++o)a.push((o+256).toString(16).substr(1));function h(e,t,i){"string"==typeof e&&(t="binary"===e?new Uint8Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){for(var n=i||0,o=0;o<16;++o)t[n+o]=s[o];return t}return function(e,t){var i=t||0,s=a;return(s[e[i+0]]+s[e[i+1]]+s[e[i+2]]+s[e[i+3]]+"-"+s[e[i+4]]+s[e[i+5]]+"-"+s[e[i+6]]+s[e[i+7]]+"-"+s[e[i+8]]+s[e[i+9]]+"-"+s[e[i+10]]+s[e[i+11]]+s[e[i+12]]+s[e[i+13]]+s[e[i+14]]+s[e[i+15]]).toLowerCase()}(s)}class l extends t{constructor(e,t){super(e),this.program=t}}class d extends i{constructor(e){super(),this.subscribe(this),this.subscribe(e),this.id=h(),this.name="Program",this.parent=e,this.args=[],this.events()}exec(...e){this.args=e,this.emit(new l("ProgramExec",this))}events(){}main(){this.end()}end(){this.emit(new l("ProgramEnd",this))}}class m extends t{constructor(e,t){super(e),this.wallpaper=t}}class c extends t{constructor(e,t){super(e);const i=getComputedStyle(t);this.screen={element:t,width:i.width,height:i.height}}}var u=("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}).performance||{};u.now||u.mozNow||u.msNow||u.oNow||u.webkitNow;if("undefined"!=typeof navigator&&"ReactNative"===navigator.product&&"undefined"==typeof crypto)throw new Error("React Native does not have a built-in secure random generator. If you don’t need unpredictable IDs use `nanoid/non-secure`. For secure IDs, import `react-native-get-random-values` before Nano ID. If you use Expo, install `expo-random` and use `nanoid/async`.");if("undefined"!=typeof msCrypto&&"undefined"==typeof crypto)throw new Error("Add `if (!window.crypto) window.crypto = window.msCrypto` before Nano ID to fix IE 11 support");if("undefined"==typeof crypto)throw new Error("Your browser does not have secure random generator. If you don’t need unpredictable IDs, you can use nanoid/non-secure.");class p extends t{constructor(e,t){super(e),this.window=t}}class g extends i{constructor(e,t){super(),this.subscribe(this),this.program=e,e.subscribe(this),this.id=this.program.name+"-"+((e=21)=>{let t="",i=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let s=63&i[e];t+=s<36?s.toString(36):s<62?(s-26).toString(36).toUpperCase():s<63?"_":"-"}return t})();const i={x:0,y:0,width:100,height:100,frame:!0,movable:!0,visible:!0,title:e.name,maximized:!1,minimized:!1};t=Object.assign({},i,t),this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.visible=t.visible,this.maximized=t.maximized,this.minimized=t.minimized,this.dragged=null,this.body=null,this.title=t.title,this.unmaximizedSize={x:this.x,y:this.y,width:this.width,height:this.height},this.element=document.createElement("div"),this.program.parent.container.appendChild(this.element),this.__setupStyle(t),this.__setupEvents(),this.events(),this.maximized&&this.emit(new p("WindowMaximize",this)),this.minimized&&this.emit(new p("WindowMinimize",this))}__setupStyle(e){if(this.element.classList.add("WWM-Window"),e.frame){this.element.innerHTML=`\n\t\t\t\t<nav class="title-bar">\n\t\t\t\t\t<span class="title-bar-program-name">${this.title}</span>\n\t\t\t\t\t<ul class="title-bar-buttons">\n\t\t\t\t\t\t<li><button class="title-bar-buttons-minimize" id="${this.id}-minimize-btn"></button></li>\n\t\t\t\t\t\t<li><button class="title-bar-buttons-maximize" id="${this.id}-maximize-btn"></button></li>\n\t\t\t\t\t\t<li><button class="title-bar-buttons-close" id="${this.id}-close-btn"></button></li>\n\t\t\t\t\t</ul>\n\t\t\t\t</nav>\n\t\t\t\t<div class="body"></div>\n\t\t\t`,this.body=this.element.querySelector(".body"),this.element.querySelector(`#${this.id}-close-btn`).addEventListener("click",e=>{e.preventDefault(),this.emit(new p("WindowClose",this))}),this.element.querySelector(`#${this.id}-maximize-btn`).addEventListener("click",e=>{e.preventDefault(),this.maximized?this.emit(new p("WindowUnmaximize",this)):this.emit(new p("WindowMaximize",this))}),this.element.querySelector(`#${this.id}-minimize-btn`).addEventListener("click",e=>{e.preventDefault(),this.emit(new p("WindowMinimize",this))});const e=this.element.querySelector(".title-bar");let t="";e.addEventListener("mousedown",i=>{i.preventDefault(),i.target===e&&(this.dragged={windowX:this.x,windowY:this.y,mouseX:i.clientX,mouseY:i.clientY},t=this.element.style.transition,this.element.style.transition="none",this.body.style.pointerEvents="none")}),e.addEventListener("dblclick",e=>{e.preventDefault(),this.maximized?this.emit(new p("WindowUnmaximize",this)):this.emit(new p("WindowMaximize",this))}),document.addEventListener("mouseup",e=>{this.dragged=null,this.element.style.transition=t,this.body.style.pointerEvents="all"}),document.addEventListener("mousemove",e=>{e.preventDefault(),this.dragged&&(this.move(this.dragged.windowX+(e.clientX-this.dragged.mouseX),this.dragged.windowY+(e.clientY-this.dragged.mouseY)),this.emit(new p("WindowDrag",this)))})}else this.element.classList.add("frameless"),this.element.innerHTML='<div class="body"></div>',this.body=this.element.querySelector(".body");this.element.id=this.id,this.setStyles({position:"absolute",transform:`translate(${this.x}px, ${this.y}px)`,width:""+this.widthPx,height:""+this.heightPx,visible:""+this.visible})}__setupEvents(){this.on("ProgramEnd",e=>{this.element.remove()}),this.on("WindowClose",e=>{this.element.remove()}),this.on("WindowUnmaximize",e=>{this.maximized=!1,this.resize(this.unmaximizedSize.width,this.unmaximizedSize.height),this.dragged?(this.move(this.dragged.mouseX-this.width/2,this.dragged.mouseY),this.dragged.windowX=this.x,this.dragged.windowY=this.y):this.move(this.unmaximizedSize.x,this.unmaximizedSize.y)}),this.on("WindowMaximize",e=>{this.unmaximizedSize.width=this.width,this.unmaximizedSize.height=this.height,this.unmaximizedSize.x=this.x,this.unmaximizedSize.y=this.y,this.move(0,0),this.resize(getComputedStyle(this.program.parent.container).width,getComputedStyle(this.program.parent.container).height),this.maximized=!0}),this.on("WindowMove",e=>{this.maximized&&this.emit(new p("WindowUnmaximize",this))}),this.program.on("ScreenResize",e=>{this.maximized&&this.resize(e.screen.width,e.screen.height)})}events(){}render(e){this.element.innerHTML=e}resize(e,t){this.width=parseInt(e),this.height=parseInt(t),this.setStyle("width",this.widthPx),this.setStyle("height",this.heightPx),this.emit(new p("WindowResize",this))}move(e,t){this.x=e,this.y=t,this.setStyle("transform",`translate(${this.x}px, ${this.y}px)`),this.emit(new p("WindowMove",this))}setStyle(e,t,i=this.element){i.style[e]=t}setStyles(e,t=this.element){for(let[i,s]of Object.entries(e))t.style[i]=s}get widthPx(){return this.width+"px"}get heightPx(){return this.height+"px"}}class w extends d{constructor(e){super(e),this.name="WWMWallpaper"}main(){let e=this.args[0],t=this.args[1];this.parent.subscribe(this);const i=getComputedStyle(this.parent.container);this.mainWindow=new g(this,{x:0,y:0,width:parseInt(i.width),height:parseInt(i.height),frame:!1,movable:!1,maximized:!0}),this.mainWindow.setStyle("background-size","cover",this.mainWindow.body),this.mainWindow.setStyle("background-position","center center",this.mainWindow.body),this.setWallpaper(e,t)}events(){this.on("ScreenResize",e=>{this.mainWindow.resize(e.screen.width,e.screen.height)}),this.on("WallpaperChange",e=>{switch(e.wallpaper.type){case"image":this.mainWindow.setStyle("background-image",e.wallpaper.value,this.mainWindow.body);break;case"color":this.mainWindow.setStyle("background-color",e.wallpaper.value,this.mainWindow.body)}})}setWallpaper(t,i){let s=new e(t,i);e.validate(s)&&this.emit(new m("WallpaperChange",s))}}class b extends d{constructor(e){super(e),this.name="TestProgram"}main(){this.parent.subscribe(this);getComputedStyle(this.parent.container);this.mainWindow=new g(this,{x:100,y:100,width:800,height:500,frame:!0});let e=document.createElement("iframe");e.src="https://colinespinas.com",e.style.width="100%",e.style.height="100%",e.style.border="none",this.mainWindow.body.appendChild(e)}events(){}}var y={System:class extends i{constructor(e){super(),this.subscribe(this);this.options=Object.assign({},{tiling:"floating",container:null},e),this.container=this.options.container?document.querySelector(this.options.container):document.body,this.container.style.position="relative",this.container.style.overflow="hidden",this.programs=[],this.__setupEvents(),this.__setupPrograms()}__setupEvents(){this.on("ProgramExec",e=>{this.programs.push(e.program),e.program.main()}),this.on("ProgramEnd",e=>{this.programs.splice(this.programs.findIndex(t=>t.id===e.program.id),1),console.log("Program closed")}),window.addEventListener("resize",()=>{this.emit(new c("ScreenResize",this.container))})}__setupPrograms(){this.exec(new w(this),"image","./ressources/wallpaper.jpg"),this.exec(new b(this))}exec(e,...t){e.parent=this,e.subscribe(this),e.args=t,this.emit(new l("ProgramExec",e))}},Program:d,Window:g,EventEmitter:class{constructor(e){this.listeners=e||[]}emit(e){for(let t=0,i=this.listeners.length;t<i;++t)this.listeners[t].trigger(e)}subscribe(e){this.listeners.indexOf(e)<=-1&&this.listeners.push(e)}},EventListener:class{constructor(){this.eventsCallbacks={}}on(e,t){this.eventsCallbacks[e]||(this.eventsCallbacks[e]={}),this.eventsCallbacks[e].on=t}once(e,t){this.eventsCallbacks[e]||(this.eventsCallbacks[e]={}),this.eventsCallbacks[e].once=t}trigger(e){this.eventsCallbacks[e.name]&&this.eventsCallbacks[e.name].once&&(this.eventsCallbacks[e.name].once(e),this.eventsCallbacks[e.name].once=null),this.eventsCallbacks[e.name]&&this.eventsCallbacks[e.name].on&&this.eventsCallbacks[e.name].on(e)}},EventHandler:i,WWMEvent:t,WallpaperEvent:m,ProgramEvent:l,ScreenEvent:c,WindowEvent:p,Wallpaper:e,Theme:class{constructor(e){this.stylesheet=e}apply(){let e=document.head.querySelector("#WWM-theme")?document.querySelector("#WWM-theme"):document.createElement("link");e.id="WWM-theme",e.rel="stylesheet",e.type="text/css",e.href=this.stylesheet,document.head.querySelector("#WWM-theme")||document.head.appendChild(e)}},WWMWallpaper:w};module.exports=y;
//# sourceMappingURL=wwm.js.map
